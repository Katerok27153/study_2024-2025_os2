---
## Front matter
title: "Отчёт по лабораторной работе №14"
subtitle: "Дисциплина: Основы администрирования операционных систем"
author: "Верниковская Екатерина Андреевна"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true # Table of contents
toc-depth: 2
lof: true # List of figures
lot: true # List of tables
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
	- spelling=modern
	- babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: PT Serif
romanfont: PT Serif
sansfont: PT Sans
monofont: PT Mono
mainfontoptions: Ligatures=TeX
romanfontoptions: Ligatures=TeX
sansfontoptions: Ligatures=TeX,Scale=MatchLowercase
monofontoptions: Scale=MatchLowercase,Scale=0.9
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float} # keep figures where there are in the text
  - \floatplacement{figure}{H} # keep figures where there are in the text
---

# Цель работы

Получить навыки создания разделов на диске и файловых систем. Получить навыки монтирования файловых систем.

# Задание

1. Добавить два диска на виртуальной машине
2. Продемонстрировать навыки создания разделов MBR с помощью fdisk
3. Продемонстрировать навыки создания логических разделов с помощью fdisk
4. Продемонстрировать навыки создания раздела подкачки с помощью fdisk
5. Продемонстрировать навыки создания разделов GPT с помощью gdisk
6. Продемонстрировать навыки форматирования файловой системы XFS
7. Продемонстрировать навыки форматирования файловой системы EXT4
8. Продемонстрировать навыки ручного монтирования файловых систем
9. Продемонстрировать навыки монтирования файловых систем с помощью /etc/fstab
10. Выполнить задание для самостоятельной работы

# Выполнение лабораторной работы

## Создание виртуальных носителей

Добавим к нашей виртуальной машине два диска размером 512 МБ. Для этого нажимаем в меню виртуальной машины *Настроить*, выбираем *Носители*. Затем на контроллере SATA нажимаем *Добавить жёсткий диск*. В открывшемся окне нажимаем *Создать образ диска*. Выбираем *VDI*, размер диска *512*, также указываем месторасположение диска и его название (disk1.vdi - для первого или disk2.vdi - для второго). После нажимаем *Создать*. В окне выбора жёсткого диска встаём на обозначение созданного диска и нажимаем *Выбрать*. После этого повторяем указанные выше действия второй раз, чтобы создать второй диск (рис. [-@fig:001]), (рис. [-@fig:002]), (рис. [-@fig:003]), (рис. [-@fig:004])

![Настройик - носители](image/лаба14_1.png){#fig:001 width=70%}

![Создание disk1.vdi](image/лаба14_2.png){#fig:002 width=70%}

![Создание disk2.vdi](image/лаба14_3.png){#fig:003 width=70%}

![Добавленные диски](image/лаба14_4.png){#fig:004 width=70%}

## Создание разделов MBR с помощью fdisk

Далее запускаем нашу виртуальную машину с добавленными дополнительными дисками disk1 и disk2. Запускаем терминала и получаем полномочия суперпользователя, используя *su -* (рис. [-@fig:005])

![Режим суперпользователя](image/лаба14_5.png){#fig:005 width=70%}

С помощью *fdisk --list* посмотрим перечень разделов на всех имеющихся в системе устройствах жёстких дисков. В списке отобразилась информация о добавленных дисках размером 512 MiB, в частности название разделов: /dev/sdb и /dev/sdc (рис. [-@fig:006])

![Перечень разделов на всех имеющихся в системе устройствах жёстких дисков](image/лаба14_6.png){#fig:006 width=70%}

Сделаем разметку диска /dev/sdb с помощью *fdisk /dev/sdb* (рис. [-@fig:007])

![Команда fdisk /dev/sdb (1)](image/лаба14_7.png){#fig:007 width=70%}

Введём *m*, чтобы получить справку по командам (рис. [-@fig:008])

![Справка по командам](image/лаба14_8.png){#fig:008 width=70%}

Нажмём *p*, чтобы просмотреть текущее распределение пространства диска (рис. [-@fig:009])

![Текущее распределение пространства диска](image/лаба14_9.png){#fig:009 width=70%}

Введём *n*, чтобы добавить новый раздел. Далее выберем *p*, чтобы создать основной раздел. Применим номер раздела (в данном случае 1), который предлагается. Далее указываем первый сектор на диске, с которого начнётся новый раздел. По умолчанию предлагается первый доступный сектор, нажимаем *Enter* для подтверждения выбора. Далее указываем последний сектор, которым будет завершён раздел. Для этого вводим *+100M* (рис. [-@fig:010])

![Добавление нового основного раздела](image/лаба14_10.png){#fig:010 width=70%}

Далее определяем тип раздела. Для этого вводи *t* и после *83* (рис. [-@fig:011])

![Определение типа раздела](image/лаба14_11.png){#fig:011 width=70%}

Нажимаем *w*, чтобы записать изменения на диск и выйти из fdisk (рис. [-@fig:012])

![Запись изменений на диск и выход из fdisk (1)](image/лаба14_12.png){#fig:012 width=70%}

Сравним выводы команд *fdisk -l /dev/sdb* и *cat /proc/partitions* (рис. [-@fig:013]), (рис. [-@fig:014])

Вывод команды *fdisk -l /dev/sdb*:

1. Размер диска: Указан общий размер диска 512 MiB (536870912 байт)
2. Модель устройства: Указано, что это диск VBox HARDDISK
3. Секторы: Общее количество секторов — 1048576
4. Системный раздел: Присутствует информация о разделах, включая информацию о sdb1 — данном разделе, его начальный и конечный секторы, объем (100M) и тип (Linux)
5. Таблица разделов: Присутствие информации о типе таблицы разделов (в данном случае, dos)

Вывод команды *cat /proc/partitions*: 

1. Размеры и блоки: Здесь отображается информация о всех устройствах и их разделах в системе, в том числе sdb
2. Выделение другим устройствам: В выводе есть другие устройства (sda, sdc и виртуальные устройства dm-*), показывая общее состояние блоков устройства
3. Отсутствие деталей: Вывод не содержит такой же детальной информации о разделе, как в fdisk, например, нет информации о типе файловой системы или состоянии нагрузки
4. Параметры: Показан только общий объем блока для каждого устройства без детальной информации о разметке
 
Основные различия:

- Уровень детализации: fdisk предоставляет более подробную информацию о каждом разделе, включая размер, тип и структуру таблицы разделов. В то время как /proc/partitions показывает более общую информацию, включая размеры, но без указания на типы разметки или файловую систему
- Ограниченность вывода: fdisk ограничен рассматриваемым устройством (в данном случае sdb), тогда как /proc/partitions предоставляет информацию обо всех устройствах и их разделах в системе
- Информация о таблице разделов: fdisk сообщает о типе таблицы разделов (например, dos), чего нет в выводе /proc/partitions

![Вывод команды fdisk -l /dev/sdb](image/лаба14_13.png){#fig:013 width=70%}

![Вывод команды cat /proc/partitions](image/лаба14_14.png){#fig:014 width=70%}

Запишим изменения в таблицу разделов ядра: *partprobe /dev/sdb* (рис. [-@fig:015])

![Запись изменений в таблицу разделов ядра](image/лаба14_15.png){#fig:015 width=70%}

## Создание логических разделов

В терминале с полномочиями администратора запустим *fdisk /dev/sdb* (рис. [-@fig:016])

![Команда fdisk /dev/sdb (2)](image/лаба14_16.png){#fig:016 width=70%}

Введём *n*, чтобы добавить новый раздел (рис. [-@fig:017])

![Добавление нового раздела (1)](image/лаба14_17.png){#fig:017 width=70%}

Введём *e*, чтобы добавить создать расширенный раздел. Далее на всех пунктах нажимаем *Enter* (рис. [-@fig:018])

![Создание расширенного раздела](image/лаба14_18.png){#fig:018 width=70%}

Теперь, когда расширенный раздел создан, мы можем создать в нём логический раздел. Из интерфейса fdisk снова нажимаем *n*. Утилита сообщит, что нет свободных первичных разделов и по умолчанию предложит добавить логический раздел с номером 5. Нажимаем *Enter*, чтобы принять выбор первого сектора в качестве сектора по умолчанию. На вопрос о последнем секторе вводим *+101M* (рис. [-@fig:019])

![Создание логического раздела](image/лаба14_19.png){#fig:019 width=70%}

После создания логического раздела вводим *w*, чтобы записать изменения на диск и выйти из fdisk (рис. [-@fig:020])

![Запись изменений на диск и выход из fdisk (2)](image/лаба14_20.png){#fig:020 width=70%}

Чтобы завершить процедуру и обновить таблицу разделов, вводим *partprobe /dev/sdb* (рис. [-@fig:021])

![Обновление таблицы разделов (1)](image/лаба14_21.png){#fig:021 width=70%}

Посмотрим информацию о добавленных разделах с помощью *cat /proc/partitions* и *fdisk --list /dev/sdb* (рис. [-@fig:022]), (рис. [-@fig:023])

![Информация о добавленных разделах: fdisk --list /dev/sdb (1)](image/лаба14_22.png){#fig:022 width=70%}

![Информация о добавленных разделах: cat /proc/partitions (1)](image/лаба14_23.png){#fig:023 width=70%}

## Создание раздела подкачки

Получаем полномочия администратора и запускаем fdisk: *fdisk /dev/sdb* (рис. [-@fig:024])

![Команда fdisk /dev/sdb (3)](image/лаба14_24.png){#fig:024 width=70%} 

Нажимем *n*, чтобы добавить новый раздел. Утилита сообщит, что нет свободных первичных разделов и по умолчанию предложит добавить логический раздел с номером раздела 6. Нажимаем *Enter*, чтобы принять первый сектор по умолчанию. На вопрос о последнем секторе вводим *+100M* (рис. [-@fig:025])

![Добавление нового раздела (2)](image/лаба14_25.png){#fig:025 width=70%} 

Далее изменим тип раздела. Для этого нажмём *t*, затем укажем номер партиции, для которой хотим изменить тип (в данном случае это номер 6). Затем введем код типа раздела (в данном случае 82 — раздел подкачки) (рис. [-@fig:026])

![Изменение типа раздела](image/лаба14_26.png){#fig:026 width=70%} 

После создания логического раздела вводим *w*, чтобы записать изменения на диск и выйти из fdisk (рис. [-@fig:027])

![Запись изменений на диск и выход из fdisk (3)](image/лаба14_27.png){#fig:027 width=70%}

ЧТобы завершить процедуру и обновить таблицу разделов ядра, вводим *partprobe /dev/sdb*. Новый раздел теперь готов к использованию (рис. [-@fig:028])

![Завершение процедуры  и обновление таблицы разделов](image/лаба14_28.png){#fig:028 width=70%}

Посмотрим информацию о добавленных разделах: *cat /proc/partitions* и  *fdisk --list /dev/sdb* (рис. [-@fig:029]), (рис. [-@fig:030])

![Информация о добавленных разделах: fdisk --list /dev/sdb (2)](image/лаба14_29.png){#fig:029 width=70%}

![Информация о добавленных разделах: cat /proc/partitions (2)](image/лаба14_30.png){#fig:030 width=70%}

Отформатируем раздел подкачки, используя команду *mkswap /dev/sdb6* (рис. [-@fig:031]) 

![Форматирование раздела подкачки](image/лаба14_31.png){#fig:031 width=70%}

Для включения вновь выделенного пространства подкачки используем *swapon /dev/sdb6* (рис. [-@fig:032]) 

![Включение вновь выделенного пространства подкачки](image/лаба14_32.png){#fig:032 width=70%}

Для просмотра размера пространства подкачки, которое в настоящее время выделено, вводим *free -m* (рис. [-@fig:033]) 

![Размер пространства подкачки](image/лаба14_33.png){#fig:033 width=70%}

## Создание разделов GPT с помощью gdisk

В терминале с полномочиями администратора с помощью gdisk посмотрим таблицы разделов и разделы на втором добавленном нами ранее диске /dev/sdc: *gdisk -l /dev/sdc* (рис. [-@fig:034])

![Таблицы разделов и разделы на втором добавленном нами ранее диске /dev/sdc](image/лаба14_34.png){#fig:034 width=70%}

Создадим раздел с помощью gdisk: *gdisk /dev/sdc* (рис. [-@fig:035])

![Команда fdisk /dev/sdc](image/лаба14_35.png){#fig:035 width=70%} 

Вводим *n*, чтобы добавить новый раздел. Принимаем номер раздела по умолчанию, который предлагается. Теперь нас просят задать первый сектор. По умолчанию будет использоваться первый сектор, доступный на диске, но также можно указать смещение. Нажимаем *Enter*, чтобы принять предлагаемый по умолчанию первый сектор. При запросе последнего сектора используем *+100M*. Далее предлагается установить тип раздела. Нажимаем *Enter*, чтобы принять тип раздела 8300 по умолчанию (рис. [-@fig:036])

![Добавление нового раздела (3)](image/лаба14_36.png){#fig:036 width=70%} 

Теперь раздел создан (но ещё не записан на диск). Нажимаем *p*, чтобы отобразить разбиение диска (рис. [-@fig:037])

![Отображение разбиения диска](image/лаба14_37.png){#fig:037 width=70%} 

Наше текущее разбиение нас устраивает. Нажимаем *w* чтобы записать изменения на диск  (рис. [-@fig:038])

![Запись изменений на диск и выход из fdisk (4)](image/лаба14_38.png){#fig:038 width=70%}

Обновим таблицу разделов: *partprobe /dev/sdc* (рис. [-@fig:039])

![Обновление таблицы разделов (2)](image/лаба14_39.png){#fig:039 width=70%}

Посмотрим информацию о добавленных разделах: *cat /proc/partitions* и *gdisk -l /dev/sdc* (рис. [-@fig:040]), (рис. [-@fig:041])

![Информация о добавленных разделах: fdisk --list /dev/sdb (3)](image/лаба14_40.png){#fig:040 width=70%}

![Информация о добавленных разделах: cat /proc/partitions (3ы)](image/лаба14_41.png){#fig:041 width=70%} 

## Форматирование файловой системы XFS

В терминале с полномочиями администратора для диска dev/sdb1 создадим файловую систему XFS: *mkfs.xfs /dev/sdb1* (рис. [-@fig:042])

![Создание файловой системы XFS](image/лаба14_42.png){#fig:042 width=70%}

Для установки метки файловой системы в xfsdisk используем команду *xfs_admin -L xfsdisk /dev/sdb1* (рис. [-@fig:043])

![Установка метки файловой системы в xfsdisk](image/лаба14_43.png){#fig:043 width=70%} 

## Форматирование файловой системы EXT4

В терминале с полномочиями администратора для диска dev/sdb5 создадим файловую систему EXT4: *mkfs.ext4 /dev/sdb5* (рис. [-@fig:044])

![Создание файловой системы EXT4](image/лаба14_44.png){#fig:044 width=70%}

Для установки метки файловой системы в ext4disk используем команду *tune2fs -L ext4disk /dev/sdb5* (рис. [-@fig:045])

![Установка метки файловой системы в ext4disk](image/лаба14_45.png){#fig:045 width=70%}  

Для установки параметров монтирования по умолчанию для файловой системы используем команду *tune2fs -o acl,user_xattr /dev/sdb5* (рис. [-@fig:046])

![Установка параметров монтирования по умолчанию для файловой системы](image/лаба14_46.png){#fig:046 width=70%} 

## Ручное монтирование файловых систем

Получим полномочия администратора. Для создания точки монтирования для раздела введём *mkdir -p /mnt/tmp* (рис. [-@fig:047])

![Создание точки монтирования для раздела (1)](image/лаба14_47.png){#fig:047 width=70%} 

Чтобы смонтировать файловую систему, используем следующую команду *mount /dev/sdb5 /mnt/tmp* (рис. [-@fig:048])

![Монтирование файловой системы](image/лаба14_48.png){#fig:048 width=70%} 

Для проверки корректности монтирования раздела введём: *mount* (рис. [-@fig:049])

![Проверка корректности монтирования раздела](image/лаба14_49.png){#fig:049 width=70%} 

Чтобы отмонтировать раздел, можно использовать umount либо с именем устройства, либо с именем точки монтирования. Таким образом, обе следующие команды будут работать: *umount /dev/sdb5* или *umount /mnt/tmp* (рис. [-@fig:050])

![Отмонтирование раздела](image/лаба14_50.png){#fig:050 width=70%}

Проверим, что раздел отмонтирован: *mount* (рис. [-@fig:051])

![Проверка, что раздел отмонтирован](image/лаба14_51.png){#fig:051 width=70%} 

## Монтирование разделов с помощью /etc/fstab

Создайте точку монтирования для раздела XFS /dev/sdb1: *mkdir -p /mnt/data* (рис. [-@fig:052])

![Создание точки монтирование для раздела XFS /dev/sdb1](image/лаба14_52.png){#fig:052 width=70%} 

Посмотрим информацию об идентификаторах блочных устройств (UUID): *blkid* (рис. [-@fig:053])

![Информация об идентификаторах блочных устройств (UUID) (1)](image/лаба14_53.png){#fig:053 width=70%} 

Введём *blkid /dev/sdb1* и затем используем мышь, чтобы скопировать значение идентификатора UUID для устройства /dev/sdb1 (рис. [-@fig:054])

![Информация об идентификаторе /dev/sdb1](image/лаба14_54.png){#fig:054 width=70%} 

Откроем файл /etc/fstab на редактирование и добавим следующую строку: *UUID=значение_идентификатора /mnt/data xfs defaults 1 2* (рис. [-@fig:055]), (рис. [-@fig:056])

![Открытие файла /etc/fstab (1)](image/лаба14_55.png){#fig:055 width=70%} 

![Редактирование файла /etc/fstab (1)](image/лаба14_56.png){#fig:056 width=70%} 

Следующая команда монтирует всё, что указано в /etc/fstab: *mount -a* (рис. [-@fig:057])

![Монтирование всего что указано в /etc/fstab](image/лаба14_57.png){#fig:057 width=70%} 

Проверим, что раздел примонтирован правильно: *df -h* (рис. [-@fig:058])

![Проверка того, что раздел примонтирован правильно (1)](image/лаба14_58.png){#fig:058 width=70%} 

## Самостоятельная работа

Задания: 

1. Добавить две партиции на диск с разбиением GPT. Создать оба раздела размером 100 MiB. Один из этих разделов должен быть настроен как пространство подкачки, другой раздел должен быть отформатирован файловой системой ext4
2. Настроить сервер для автоматического монтирования этих разделов. Установить раздел ext4 на /mnt/data-ext и установить пространство подкачки в качестве области подкачки
3. Перезагрузить систему и убедиться, что всё установлено правильно

Создадим первый раздел (рис. [-@fig:059])

![Создание первого раздела](image/лаба14_59.png){#fig:059 width=70%} 

Отформатируем первый раздел: *mkfs.ext4 /dev/sdc2* (рис. [-@fig:060])

![Форматирование первого раздела](image/лаба14_60.png){#fig:060 width=70%} 

Создадим второй раздел (рис. [-@fig:061])

![Создание второго раздела](image/лаба14_61.png){#fig:061 width=70%} 

Настроим второй раздел как пространство подкачки: *mkswap /dev/sdc3* и *swapon /dev/sdc3*  (рис. [-@fig:062])

![Настройка второго раздела](image/лаба14_62.png){#fig:062 width=70%} 

Создадим точку монтирования для раздела: *mkdir -p /mnt/data-ext* (рис. [-@fig:063])

![Создание точки монтирования для раздела (2)](image/лаба14_63.png){#fig:063 width=70%}

Посмотрим информацию об идентификаторах блочных устройств (UUID): *blkid*. И скопируем значение идентификатора UUID для устройства /dev/sdc2 (рис. [-@fig:064])

![Информация об идентификаторах блочных устройств (UUID) (2)](image/лаба14_64.png){#fig:064 width=70%}

Откроем файл /etc/fstab на редактирование и добавим следующую строку: *UUID=значение_идентификатора /mnt/data-ext ext4 defaults 1 2* (рис. [-@fig:065]), (рис. [-@fig:066])

![Открытие файла /etc/fstab (2)](image/лаба14_65.png){#fig:065 width=70%} 

![Редактирование файла /etc/fstab (2)](image/лаба14_66.png){#fig:066 width=70%} 

Введём команду *mount -a* (рис. [-@fig:067])

![Команда mount -a](image/лаба14_67.png){#fig:067 width=70%} 

Проверим, что раздел примонтирован правильно: *df -h* (рис. [-@fig:068])

![Проверка того, что раздел примонтирован правильно (2)](image/лаба14_68.png){#fig:068 width=70%} 

Далее перезагрузим ОС и проверим, что всё установлено правильно (рис. [-@fig:069])

![Проверка после перезагрузки ОС](image/лаба14_69.png){#fig:069 width=70%} 

# Контрольные вопросы + ответы

1. Какой инструмент используется для создания разделов GUID?

gdisk

2. Какой инструмент применяется для создания разделов MBR?

fdisk

3. Какой файл используется для автоматического монтирования разделов во время загрузки?

/etc/fstab

4. Какой вариант монтирования целесообразно выбрать, если необходимо, чтобы файловая система не была автоматически примонтирована во время загрузки?

mount /dev/sdb5/mnt/tmp

5. Какая команда позволяет форматировать раздел с типом 82 с соответствующей файловой системой?

t

6. Вы только что добавили несколько разделов для автоматического монтирования при загрузке. Как можно безопасно проверить, будет ли это работать без реальной перезагрузки?

df -h

7. Какая файловая система создаётся, если вы используете команду mkfs без какой-либо спецификации файловой системы?

swap

8. Как форматировать раздел EXT4?

mkfs.ext4 /dev/sdb"number"
tune2fs -L ext4disk /dev/sdb"number"
tune2fs -o acl,user_xattar /dev/sdb"number"

9. Как найти UUID для всех устройств на компьютере?

blkid

# Выводы

В ходе выполнения лабораторной работы мы получили навыки создания разделов на диске и файловых систем. Также получили навыки монтирования файловых систем

# Список литературы

1. Лаборатораня работа №14 [Электронный ресурс] URL: https://esystem.rudn.ru/pluginfile.php/2400753/mod_resource/content/4/015-partition.pdf
