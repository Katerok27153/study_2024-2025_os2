---
## Front matter
lang: ru-RU
title: Лабораторная работа №14
subtitle: Основы администрирования операционных систем
author:
  - Верниковская Е. А., НПИбд-01-23
institute:
  - Российский университет дружбы народов, Москва, Россия
date: 6 декабря 2024

## i18n babel
babel-lang: russian
babel-otherlangs: english

## Formatting pdf
toc: false
toc-title: Содержание
slide_level: 2
aspectratio: 169
section-titles: true
theme: metropolis
header-includes:
 - \metroset{progressbar=frametitle,sectionpage=progressbar,numbering=fraction}
 - '\makeatletter'
 - '\beamer@ignorenonframefalse'
 - '\makeatother'
 
## Fonts
mainfont: PT Serif
romanfont: PT Serif
sansfont: PT Sans
monofont: PT Mono
mainfontoptions: Ligatures=TeX
romanfontoptions: Ligatures=TeX
sansfontoptions: Ligatures=TeX,Scale=MatchLowercase
monofontoptions: Scale=MatchLowercase,Scale=0.9
---

# Вводная часть

## Цель работы

Получить навыки создания разделов на диске и файловых систем. Получить навыки монтирования файловых систем

## Задание

1. Добавить два диска на виртуальной машине
2. Продемонстрировать навыки создания разделов MBR с помощью fdisk
3. Продемонстрировать навыки создания логических разделов с помощью fdisk
4. Продемонстрировать навыки создания раздела подкачки с помощью fdisk
5. Продемонстрировать навыки создания разделов GPT с помощью gdisk
6. Продемонстрировать навыки форматирования файловой системы XFS
7. Продемонстрировать навыки форматирования файловой системы EXT4
8. Продемонстрировать навыки ручного монтирования файловых систем
9. Продемонстрировать навыки монтирования файловых систем с помощью /etc/fstab
10. Выполнить задание для самостоятельной работы

# Выполнение лабораторной работы

## Создание виртуальных носителей

Добавим к нашей виртуальной машине два диска размером 512 МБ. Для этого нажимаем в меню виртуальной машины *Настроить*, выбираем *Носители*. Затем на контроллере SATA нажимаем *Добавить жёсткий диск*. В открывшемся окне нажимаем *Создать образ диска*. Выбираем *VDI*, размер диска *512*, также указываем месторасположение диска и его название (disk1.vdi - для первого или disk2.vdi - для второго). После нажимаем *Создать*. В окне выбора жёсткого диска встаём на обозначение созданного диска и нажимаем *Выбрать*. После этого повторяем указанные выше действия второй раз, чтобы создать второй диск (рис. 1), (рис. 2), (рис. 3), (рис. 4)

## Создание виртуальных носителей

![Настройик - носители](image/лаба14_1.png){#fig:001 width=70%}

## Создание виртуальных носителей

![Создание disk1.vdi](image/лаба14_2.png){#fig:002 width=70%}

## Создание виртуальных носителей

![Создание disk2.vdi](image/лаба14_3.png){#fig:003 width=70%}

## Создание виртуальных носителей

![Добавленные диски](image/лаба14_4.png){#fig:004 width=70%}

## Создание разделов MBR с помощью fdisk

Далее запускаем нашу виртуальную машину с добавленными дополнительными дисками disk1 и disk2. Запускаем терминала и получаем полномочия суперпользователя, используя *su -* (рис. 5)

![Режим суперпользователя](image/лаба14_5.png){#fig:005 width=70%}

## Создание разделов MBR с помощью fdisk

С помощью *fdisk --list* посмотрим перечень разделов на всех имеющихся в системе устройствах жёстких дисков. В списке отобразилась информация о добавленных дисках размером 512 MiB, в частности название разделов: /dev/sdb и /dev/sdc (рис. 6)

![Перечень разделов на всех имеющихся в системе устройствах жёстких дисков](image/лаба14_6.png){#fig:006 width=20%}

## Создание разделов MBR с помощью fdisk

Сделаем разметку диска /dev/sdb с помощью *fdisk /dev/sdb* (рис. 7)

![Команда fdisk /dev/sdb (1)](image/лаба14_7.png){#fig:007 width=70%}

## Создание разделов MBR с помощью fdisk

Введём *m*, чтобы получить справку по командам (рис. 8)

![Справка по командам](image/лаба14_8.png){#fig:008 width=20%}

## Создание разделов MBR с помощью fdisk

Нажмём *p*, чтобы просмотреть текущее распределение пространства диска (рис. 9)

![Текущее распределение пространства диска](image/лаба14_9.png){#fig:009 width=70%}

## Создание разделов MBR с помощью fdisk

Введём *n*, чтобы добавить новый раздел. Далее выберем *p*, чтобы создать основной раздел. Применим номер раздела (в данном случае 1), который предлагается. Далее указываем первый сектор на диске, с которого начнётся новый раздел. По умолчанию предлагается первый доступный сектор, нажимаем *Enter* для подтверждения выбора. Далее указываем последний сектор, которым будет завершён раздел. Для этого вводим *+100M* (рис. 10)

![Добавление нового основного раздела](image/лаба14_10.png){#fig:010 width=70%}

## Создание разделов MBR с помощью fdisk

Далее определяем тип раздела. Для этого вводи *t* и после *83* (рис. 11)

![Определение типа раздела](image/лаба14_11.png){#fig:011 width=30%}

## Создание разделов MBR с помощью fdisk

Нажимаем *w*, чтобы записать изменения на диск и выйти из fdisk (рис. 12)

![Запись изменений на диск и выход из fdisk (1)](image/лаба14_12.png){#fig:012 width=70%}

## Создание разделов MBR с помощью fdisk

Сравним выводы команд *fdisk -l /dev/sdb* и *cat /proc/partitions* (рис. 13), (рис. 14)

![Вывод команды fdisk -l /dev/sdb](image/лаба14_13.png){#fig:013 width=70%}

## Создание разделов MBR с помощью fdisk

![Вывод команды cat /proc/partitions](image/лаба14_14.png){#fig:014 width=70%}

## Создание разделов MBR с помощью fdisk

Запишим изменения в таблицу разделов ядра: *partprobe /dev/sdb* (рис. 15)

![Запись изменений в таблицу разделов ядра](image/лаба14_15.png){#fig:015 width=70%}

## Создание логических разделов

В терминале с полномочиями администратора запустим *fdisk /dev/sdb* (рис. 16)

![Команда fdisk /dev/sdb (2)](image/лаба14_16.png){#fig:016 width=70%}

## Создание логических разделов

Введём *n*, чтобы добавить новый раздел (рис. 17)

![Добавление нового раздела (1)](image/лаба14_17.png){#fig:017 width=70%}

## Создание логических разделов

Введём *e*, чтобы добавить создать расширенный раздел. Далее на всех пунктах нажимаем *Enter* (рис. 18)

![Создание расширенного раздела](image/лаба14_18.png){#fig:018 width=70%}

## Создание логических разделов

Теперь, когда расширенный раздел создан, мы можем создать в нём логический раздел. Из интерфейса fdisk снова нажимаем *n*. Утилита сообщит, что нет свободных первичных разделов и по умолчанию предложит добавить логический раздел с номером 5. Нажимаем *Enter*, чтобы принять выбор первого сектора в качестве сектора по умолчанию. На вопрос о последнем секторе вводим *+101M* (рис. 19)

![Создание логического раздела](image/лаба14_19.png){#fig:019 width=70%}

## Создание логических разделов

После создания логического раздела вводим *w*, чтобы записать изменения на диск и выйти из fdisk (рис. 20)

![Запись изменений на диск и выход из fdisk (2)](image/лаба14_20.png){#fig:020 width=70%}

## Создание логических разделов

Чтобы завершить процедуру и обновить таблицу разделов, вводим *partprobe /dev/sdb* (рис. 21)

![Обновление таблицы разделов (1)](image/лаба14_21.png){#fig:021 width=70%}

## Создание логических разделов

Посмотрим информацию о добавленных разделах с помощью *cat /proc/partitions* и *fdisk --list /dev/sdb* (рис. 22), (рис. 23)

![Информация о добавленных разделах: fdisk --list /dev/sdb (1)](image/лаба14_22.png){#fig:022 width=70%}

## Создание логических разделов

![Информация о добавленных разделах: cat /proc/partitions (1)](image/лаба14_23.png){#fig:023 width=70%}

## Создание раздела подкачки

Получаем полномочия администратора и запускаем fdisk: *fdisk /dev/sdb* (рис. 24)

![Команда fdisk /dev/sdb (3)](image/лаба14_24.png){#fig:024 width=70%} 

## Создание раздела подкачки

Нажимем *n*, чтобы добавить новый раздел. Утилита сообщит, что нет свободных первичных разделов и по умолчанию предложит добавить логический раздел с номером раздела 6. Нажимаем *Enter*, чтобы принять первый сектор по умолчанию. На вопрос о последнем секторе вводим *+100M* (рис. 25)

![Добавление нового раздела (2)](image/лаба14_25.png){#fig:025 width=70%} 

## Создание раздела подкачки

Далее изменим тип раздела. Для этого нажмём *t*, затем укажем номер партиции, для которой хотим изменить тип (в данном случае это номер 6). Затем введем код типа раздела (в данном случае 82 — раздел подкачки) (рис. 26)

![Изменение типа раздела](image/лаба14_26.png){#fig:026 width=70%} 

## Создание раздела подкачки

После создания логического раздела вводим *w*, чтобы записать изменения на диск и выйти из fdisk (рис. 27)

![Запись изменений на диск и выход из fdisk (3)](image/лаба14_27.png){#fig:027 width=70%}

## Создание раздела подкачки

ЧТобы завершить процедуру и обновить таблицу разделов ядра, вводим *partprobe /dev/sdb*. Новый раздел теперь готов к использованию (рис. 28)

![Завершение процедуры  и обновление таблицы разделов](image/лаба14_28.png){#fig:028 width=70%}

## Создание раздела подкачки

Посмотрим информацию о добавленных разделах: *cat /proc/partitions* и  *fdisk --list /dev/sdb* (рис. 29), (рис. 30)

![Информация о добавленных разделах: fdisk --list /dev/sdb (2)](image/лаба14_29.png){#fig:029 width=70%}

## Создание раздела подкачки

![Информация о добавленных разделах: cat /proc/partitions (2)](image/лаба14_30.png){#fig:030 width=60%}

## Создание раздела подкачки

Отформатируем раздел подкачки, используя команду *mkswap /dev/sdb6* (рис. 31) 

![Форматирование раздела подкачки](image/лаба14_31.png){#fig:031 width=70%}

## Создание раздела подкачки

Для включения вновь выделенного пространства подкачки используем *swapon /dev/sdb6* (рис. 32) 

![Включение вновь выделенного пространства подкачки](image/лаба14_32.png){#fig:032 width=70%}

## Создание раздела подкачки

Для просмотра размера пространства подкачки, которое в настоящее время выделено, вводим *free -m* (рис. 33) 

![Размер пространства подкачки](image/лаба14_33.png){#fig:033 width=70%}

## Создание разделов GPT с помощью gdisk

В терминале с полномочиями администратора с помощью gdisk посмотрим таблицы разделов и разделы на втором добавленном нами ранее диске /dev/sdc: *gdisk -l /dev/sdc* (рис. 34)

![Таблицы разделов и разделы на втором добавленном нами ранее диске /dev/sdc](image/лаба14_34.png){#fig:034 width=40%}

## Создание разделов GPT с помощью gdisk

Создадим раздел с помощью gdisk: *gdisk /dev/sdc* (рис. 35)

![Команда fdisk /dev/sdc](image/лаба14_35.png){#fig:035 width=60%} 

## Создание разделов GPT с помощью gdisk

Вводим *n*, чтобы добавить новый раздел. Принимаем номер раздела по умолчанию, который предлагается. Теперь нас просят задать первый сектор. По умолчанию будет использоваться первый сектор, доступный на диске, но также можно указать смещение. Нажимаем *Enter*, чтобы принять предлагаемый по умолчанию первый сектор. При запросе последнего сектора используем *+100M*. Далее предлагается установить тип раздела. Нажимаем *Enter*, чтобы принять тип раздела 8300 по умолчанию (рис. 36)

![Добавление нового раздела (3)](image/лаба14_36.png){#fig:036 width=70%} 

## Создание разделов GPT с помощью gdisk

Теперь раздел создан (но ещё не записан на диск). Нажимаем *p*, чтобы отобразить разбиение диска (рис. 37)

![Отображение разбиения диска](image/лаба14_37.png){#fig:037 width=70%} 

## Создание разделов GPT с помощью gdisk

Наше текущее разбиение нас устраивает. Нажимаем *w* чтобы записать изменения на диск  (рис. 38)

![Запись изменений на диск и выход из fdisk (4)](image/лаба14_38.png){#fig:038 width=70%}

## Создание разделов GPT с помощью gdisk

Обновим таблицу разделов: *partprobe /dev/sdc* (рис. 39)

![Обновление таблицы разделов (2)](image/лаба14_39.png){#fig:039 width=70%}

## Создание разделов GPT с помощью gdisk

Посмотрим информацию о добавленных разделах: *cat /proc/partitions* и *gdisk -l /dev/sdc* (рис. 40), (рис. 41)

![Информация о добавленных разделах: fdisk --list /dev/sdb (3)](image/лаба14_40.png){#fig:040 width=50%}

## Создание разделов GPT с помощью gdisk

![Информация о добавленных разделах: cat /proc/partitions (3ы)](image/лаба14_41.png){#fig:041 width=60%} 

## Форматирование файловой системы XFS

В терминале с полномочиями администратора для диска dev/sdb1 создадим файловую систему XFS: *mkfs.xfs /dev/sdb1* (рис. 42)

![Создание файловой системы XFS](image/лаба14_42.png){#fig:042 width=70%}

## Форматирование файловой системы XFS

Для установки метки файловой системы в xfsdisk используем команду *xfs_admin -L xfsdisk /dev/sdb1* (рис. 43)

![Установка метки файловой системы в xfsdisk](image/лаба14_43.png){#fig:043 width=70%} 

## Форматирование файловой системы EXT4

В терминале с полномочиями администратора для диска dev/sdb5 создадим файловую систему EXT4: *mkfs.ext4 /dev/sdb5* (рис. 44)

![Создание файловой системы EXT4](image/лаба14_44.png){#fig:044 width=70%}

## Форматирование файловой системы EXT4

Для установки метки файловой системы в ext4disk используем команду *tune2fs -L ext4disk /dev/sdb5* (рис. 45)

![Установка метки файловой системы в ext4disk](image/лаба14_45.png){#fig:045 width=70%}  

## Форматирование файловой системы EXT4

Для установки параметров монтирования по умолчанию для файловой системы используем команду *tune2fs -o acl,user_xattr /dev/sdb5* (рис. 46)

![Установка параметров монтирования по умолчанию для файловой системы](image/лаба14_46.png){#fig:046 width=70%} 

## Ручное монтирование файловых систем

Получим полномочия администратора. Для создания точки монтирования для раздела введём *mkdir -p /mnt/tmp* (рис. 47)

![Создание точки монтирования для раздела (1)](image/лаба14_47.png){#fig:047 width=70%} 

## Ручное монтирование файловых систем

Чтобы смонтировать файловую систему, используем следующую команду *mount /dev/sdb5 /mnt/tmp* (рис. 48)

![Монтирование файловой системы](image/лаба14_48.png){#fig:048 width=70%} 

## Ручное монтирование файловых систем

Для проверки корректности монтирования раздела введём: *mount* (рис. 49)

![Проверка корректности монтирования раздела](image/лаба14_49.png){#fig:049 width=70%} 

## Ручное монтирование файловых систем

Чтобы отмонтировать раздел, можно использовать umount либо с именем устройства, либо с именем точки монтирования. Таким образом, обе следующие команды будут работать: *umount /dev/sdb5* или *umount /mnt/tmp* (рис. 50)

![Отмонтирование раздела](image/лаба14_50.png){#fig:050 width=70%}

## Ручное монтирование файловых систем

Проверим, что раздел отмонтирован: *mount* (рис. 51)

![Проверка, что раздел отмонтирован](image/лаба14_51.png){#fig:051 width=70%} 

## Монтирование разделов с помощью /etc/fstab

Создайте точку монтирования для раздела XFS /dev/sdb1: *mkdir -p /mnt/data* (рис. 52)

![Создание точки монтирование для раздела XFS /dev/sdb1](image/лаба14_52.png){#fig:052 width=70%} 

## Монтирование разделов с помощью /etc/fstab

Посмотрим информацию об идентификаторах блочных устройств (UUID): *blkid* (рис. 53)

![Информация об идентификаторах блочных устройств (UUID) (1)](image/лаба14_53.png){#fig:053 width=70%} 

## Монтирование разделов с помощью /etc/fstab

Введём *blkid /dev/sdb1* и затем используем мышь, чтобы скопировать значение идентификатора UUID для устройства /dev/sdb1 (рис. 54)

![Информация об идентификаторе /dev/sdb1](image/лаба14_54.png){#fig:054 width=70%} 

## Монтирование разделов с помощью /etc/fstab

Откроем файл /etc/fstab на редактирование и добавим следующую строку: *UUID=значение_идентификатора /mnt/data xfs defaults 1 2* (рис. 55), (рис. 56)

![Открытие файла /etc/fstab (1)](image/лаба14_55.png){#fig:055 width=70%} 

## Монтирование разделов с помощью /etc/fstab

![Редактирование файла /etc/fstab (1)](image/лаба14_56.png){#fig:056 width=70%} 

## Монтирование разделов с помощью /etc/fstab

Следующая команда монтирует всё, что указано в /etc/fstab: *mount -a* (рис. 57)

![Монтирование всего что указано в /etc/fstab](image/лаба14_57.png){#fig:057 width=70%} 

## Монтирование разделов с помощью /etc/fstab

Проверим, что раздел примонтирован правильно: *df -h* (рис. 58)

![Проверка того, что раздел примонтирован правильно (1)](image/лаба14_58.png){#fig:058 width=70%} 

## Самостоятельная работа

Задания: 

1. Добавить две партиции на диск с разбиением GPT. Создать оба раздела размером 100 MiB. Один из этих разделов должен быть настроен как пространство подкачки, другой раздел должен быть отформатирован файловой системой ext4
2. Настроить сервер для автоматического монтирования этих разделов. Установить раздел ext4 на /mnt/data-ext и установить пространство подкачки в качестве области подкачки
3. Перезагрузить систему и убедиться, что всё установлено правильно

## Самостоятельная работа

Создадим первый раздел (рис. 59)

![Создание первого раздела](image/лаба14_59.png){#fig:059 width=50%} 

## Самостоятельная работа

Отформатируем первый раздел: *mkfs.ext4 /dev/sdc2* (рис. 60)

![Форматирование первого раздела](image/лаба14_60.png){#fig:060 width=70%} 

## Самостоятельная работа

Создадим второй раздел (рис. 61)

![Создание второго раздела](image/лаба14_61.png){#fig:061 width=50%} 

## Самостоятельная работа

Настроим второй раздел как пространство подкачки: *mkswap /dev/sdc3* и *swapon /dev/sdc3*  (рис. 62)

![Настройка второго раздела](image/лаба14_62.png){#fig:062 width=70%} 

## Самостоятельная работа

Создадим точку монтирования для раздела: *mkdir -p /mnt/data-ext* (рис. 63)

![Создание точки монтирования для раздела (2)](image/лаба14_63.png){#fig:063 width=70%}

## Самостоятельная работа

Посмотрим информацию об идентификаторах блочных устройств (UUID): *blkid*. И скопируем значение идентификатора UUID для устройства /dev/sdc2 (рис. 64)

![Информация об идентификаторах блочных устройств (UUID) (2)](image/лаба14_64.png){#fig:064 width=70%}

## Самостоятельная работа

Откроем файл /etc/fstab на редактирование и добавим следующую строку: *UUID=значение_идентификатора /mnt/data-ext ext4 defaults 1 2* (рис. 65), (рис. 66)

![Открытие файла /etc/fstab (2)](image/лаба14_65.png){#fig:065 width=70%} 

## Самостоятельная работа

![Редактирование файла /etc/fstab (2)](image/лаба14_66.png){#fig:066 width=70%} 

## Самостоятельная работа

Введём команду *mount -a* (рис. 67)

![Команда mount -a](image/лаба14_67.png){#fig:067 width=70%} 

## Самостоятельная работа

Проверим, что раздел примонтирован правильно: *df -h* (рис. 68)

![Проверка того, что раздел примонтирован правильно (2)](image/лаба14_68.png){#fig:068 width=70%} 

## Самостоятельная работа

Далее перезагрузим ОС и проверим, что всё установлено правильно (рис. 69)

![Проверка после перезагрузки ОС](image/лаба14_69.png){#fig:069 width=60%} 

# Подведение итогов

## Выводы

В ходе выполнения лабораторной работы мы получили навыки создания разделов на диске и файловых систем. Также получили навыки монтирования файловых систем

## Список литературы

1. Лаборатораня работа №14 [Электронный ресурс] URL: https://esystem.rudn.ru/pluginfile.php/2400753/mod_resource/content/4/015-partition.pdf
