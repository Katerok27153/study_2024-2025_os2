---
## Front matter
lang: ru-RU
title: Лабораторная работа №15
subtitle: Основы администрирования операционных систем
author:
  - Верниковская Е. А., НПИбд-01-23
institute:
  - Российский университет дружбы народов, Москва, Россия
date: 14 декабря 2024

## i18n babel
babel-lang: russian
babel-otherlangs: english

## Formatting pdf
toc: false
toc-title: Содержание
slide_level: 2
aspectratio: 169
section-titles: true
theme: metropolis
header-includes:
 - \metroset{progressbar=frametitle,sectionpage=progressbar,numbering=fraction}
 - '\makeatletter'
 - '\beamer@ignorenonframefalse'
 - '\makeatother'
 
## Fonts
mainfont: PT Serif
romanfont: PT Serif
sansfont: PT Sans
monofont: PT Mono
mainfontoptions: Ligatures=TeX
romanfontoptions: Ligatures=TeX
sansfontoptions: Ligatures=TeX,Scale=MatchLowercase
monofontoptions: Scale=MatchLowercase,Scale=0.9
---

# Вводная часть

## Цель работы

Получить навыки управления логическими томами.

## Задание

1. Продемонстрировать навыки создания физических томов на LVM
2. Продемонстрировать навыки создания группы томов и логических томов на LVM
3. Продемонстрировать навыки изменения размера логических томов на LVM
4. Выполнить задание для самостоятельной работы

# Выполнение лабораторной работы

## Создание физического тома

Запускаем терминала и получаем полномочия суперпользователя, используя *su -* (рис. 1)

![Режим суперпользователя](image/лаба15_1.png){#fig:001 width=70%}

## Создание физического тома

В файле /etc/fstab закомментируем строки автомонтирования /mnt/data и /mnt/data-ext (рис. 2), (рис. 3)

![Открытие файла /etc/fstab (1)](image/лаба15_2.png){#fig:002 width=70%}

## Создание физического тома

![Редактирование файла /etc/fstab (1)](image/лаба15_3.png){#fig:003 width=70%}

## Создание физического тома

Отмонтируем /mnt/data и /mnt/data-ext: *umount /mnt/data* и *umount /mnt/data-ext* (рис. 4)

![Отмонтирование /mnt/data и /mnt/data-ext](image/лаба15_4.png){#fig:004 width=70%}

## Создание физического тома

С помощью команды *mount* без параметров убедимся, что диски /dev/sdb и /dev/sdc не подмонтированы (рис. 5)

![Проверка, что диски не подмонтированы](image/лаба15_5.png){#fig:005 width=60%}

## Создание физического тома

С помощью fdisk сделаем новую разметку для /dev/sdb и /dev/sdc, удалив ранее созданные партиции:

- В терминале с полномочиями администратора вводим *fdisk /dev/sdb*
- Вводим *p* для просмотра текущей разметки дискового пространства. Затем для удаления всех имеющихся партиций на диске достаточно создаём новую пустую таблицу DOS-партиции, используя команду *o*. Убедимся, что партиции удалены, введя *p*. Сохраним изменения, введя *w*.

(рис. 6)

## Создание физического тома

![Создание новой разметки для /dev/sdb и /dev/sdc](image/лаба15_6.png){#fig:006 width=40%}

## Создание физического тома

Записываем изменения в таблицу разделов ядра: *partprobe /dev/sdb* (рис. 7)

![Запись изменений в таблицу разделов ядра](image/лаба15_7.png){#fig:007 width=70%}

## Создание физического тома

Посмотрим информацию о разделах: *cat /proc/partitions* и *fdisk --list /dev/sdb* (рис. 8), (рис. 9)

![Инофрмация о разделах командой cat /proc/partitions](image/лаба15_8.png){#fig:008 width=60%}

## Создание физического тома

![Инофрмация о разделах командой fdisk --list /dev/sdb](image/лаба15_9.png){#fig:009 width=70%}

## Создание физического тома

В терминале с полномочиями администратора с помощью fdisk создадим основной раздел с типом LVM:

- Вводим *fdisk /dev/sdb*
- Вводим *n*, чтобы создать новый раздел. Выбираем *p*, чтобы сделать его основным разделом, и используем номер раздела, который предлагается по умолчанию. Если мы используем чистое устройство, это будет номер раздела 1.
- Нажимаем *Enter* при запросе для первого сектора и введите *+100M*, чтобы выбрать последний сектор.

## Создание физического тома

- Вернувшись в приглашение fdisk, вводим *t*, чтобы изменить тип раздела. Поскольку существует только один раздел, fdisk не спрашивает, какой раздел использовать.
– Программа запрашивает тип раздела, который мы хотим использовать. Выбираем *8e*. Затем нажимаем *w*, чтобы записать изменения на диск и выйти из fdisk.

(рис. 10)

## Создание физического тома

![Создание нового раздела с типом LVM](image/лаба15_10.png){#fig:010 width=50%}

## Создание физического тома

Далее обновляем таблицу разделов: *partprobe /dev/sdb* (рис. 11)

![Обновление таблицы разделов ядра (1)](image/лаба15_11.png){#fig:011 width=70%}

## Создание физического тома

Теперь, когда раздел был создан, мы должны указать его как физический том LVM. Для
этого вводим: *pvcreate /dev/sdb1* (рис. 12)

![Указание раздела /dev/sdb1 как физический том LVM](image/лаба15_12.png){#fig:012 width=70%}

## Создание физического тома

Теперь вводим *pvs*, чтобы убедиться, что физический том создан успешно (рис. 13)

![Проверка, что физический том создан](image/лаба15_13.png){#fig:013 width=70%}

## Создание группы томов и логических томов

Создадим группу томов с присвоенным ей физическим томом: *vgcreate vgdata /dev/sdb1* и убедимся, что группа томов была создана успешно: *vgs* (рис. 14), (рис. 15)

![Создание группы томов с присвоенным ей физическим томом /dev/sdb1](image/лаба15_14.png){#fig:014 width=70%}

## Создание группы томов и логических томов

![Проверка, что группа томов была создана](image/лаба15_15.png){#fig:015 width=70%}

## Создание группы томов и логических томов

Затем вводим снова *pvs*. Теперь эта команда показывает имя физических томов с именами групп томов, которым они назначены (рис. 16)

![Команда pvs](image/лаба15_16.png){#fig:016 width=70%}

## Создание группы томов и логических томов

Вводим *lvcreate -n lvdata -l 50%FREE vgdata*. Это создаст логический том LVM с именем lvdata, который будет использовать 50% доступного дискового пространства в группе томов vgdata (рис. 17)

![Создание логического тома LVM с именем lvdata](image/лаба15_17.png){#fig:017 width=70%}

## Создание группы томов и логических томов

Для проверки успешного добавления тома вводим *lvs* (рис. 18)

![Проверка успешного добавления тома](image/лаба15_18.png){#fig:018 width=70%}

## Создание группы томов и логических томов

На этом этапе мы готовы создать файловую систему поверх логического тома. Для этого вводим *mkfs.ext4 /dev/vgdata/lvdata* (рис. 19)

![Создание файловой системы ext4 поверх логического тома](image/лаба15_19.png){#fig:019 width=70%}

## Создание группы томов и логических томов

Далее создаём папку, на которую можно смонтировать том: *mkdir -p /mnt/data* (рис. 20)

![Создание папки /mnt/data](image/лаба15_20.png){#fig:020 width=70%}

## Создание группы томов и логических томов

После добавляем следующую строку в /etc/fstab: */dev/vgdata/lvdata /mnt/data ext4 defaults 1 2* (рис. 21), (рис. 22)

![Открытие файла /etc/fstab (2)](image/лаба15_21.png){#fig:021 width=70%}

## Создание группы томов и логических томов

![Редактирование файла /etc/fstab (2)](image/лаба15_22.png){#fig:022 width=70%}

## Создание группы томов и логических томов

Проверим, монтируется ли файловая система: *mount -a* и *mount | grep /mnt* (рис. 23)

![Проверка, что файловая система монтируется (1)](image/лаба15_23.png){#fig:023 width=70%}

## Изменение размера логических томов

В терминале с полномочиями администратора вводим *pvs* и *vgs*, чтобы отобразить текущую конфигурацию физических томов и группы томов (рис. 24)

![Текущая конфигурация физических томов и группы томов](image/лаба15_24.png){#fig:024 width=70%}

## Изменение размера логических томов

С помощью fdisk добавим раздел /dev/sdb2 размером 100М. Зададим тип раздела 8e. После обновляем таблицу разделов: *partprobe /dev/sdb* (рис. 25), (рис. 26)

![Добавление раздела /dev/sdb2](image/лаба15_25.png){#fig:025 width=40%}

## Изменение размера логических томов

![Обновление таблицы разделов ядра (2)](image/лаба15_26.png){#fig:026 width=70%}

## Изменение размера логических томов

Создадим физический том: *pvcreate /dev/sdb2* (рис. 27)

![Создание физического тома](image/лаба15_27.png){#fig:027 width=70%}

## Изменение размера логических томов

Расширяем vgdata: *vgextend vgdata /dev/sdb2* (рис. 28)

![Расширение vgdata](image/лаба15_28.png){#fig:028 width=70%}

## Изменение размера логических томов

Проверим, что размер доступной группы томов увеличен: *vgs* (рис. 29)

![Проверка, что размер доступной группы томов увеличен](image/лаба15_29.png){#fig:029 width=70%}

## Изменение размера логических томов

Проверим текущий размер логического тома lvdata: *lvs* (рис. 30)

![Проверка текущего размера логического тома lvdata](image/лаба15_30.png){#fig:030 width=70%}

## Изменение размера логических томов

Проверим текущий размер файловой системы на lvdata: *df -h* (рис. 31)

![Проверка текущего размера файловой системы на lvdata](image/лаба15_31.png){#fig:031 width=70%}

## Изменение размера логических томов

Увеличим lvdata на 50% оставшегося доступного дискового пространства в группе томов: *lvextend -r -l +50%FREE /dev/vgdata/lvdata* (рис. 32)

![Увеличение lvdata на 50% оставшегося доступного дискового пространства в группе томов](image/лаба15_32.png){#fig:032 width=70%}

## Изменение размера логических томов

Убедимся, что добавленное дисковое пространство стало доступным: *lvs* и *df -h* (рис. 33)

![Проверка, что добавленное дисковое пространство стало доступным](image/лаба15_33.png){#fig:033 width=70%}

## Изменение размера логических томов

Уменьшим размер lvdata на 50 МБ: *lvreduce -r -L -50M /dev/vgdata/lvdata* (рис. 34)

![Уменьшение размера lvdata на 50 МБ](image/лаба15_34.png){#fig:034 width=70%}

## Изменение размера логических томов

Убедимся в успешном изменении дискового пространства: *lvs* и  *df -h* (рис. 35)

![Проверка, что успешного изменения дискового пространства](image/лаба15_35.png){#fig:035 width=70%}

## Самостоятельная работа

Задания: 

1. Создание логический том lvgroup размером 200 МБ. Отформатировать его в файловой системе XFS и смонтировать его постоянно на /mnt/groups. Перезагрузить виртуальную машину, чтобы убедиться, что устройство подключается.
2. После перезагрузки добавить ещё 150 МБ к тому lvgroup. Убедиться, что размер файловой системы также изменится при изменении размера тома.
3. Убедиться, что расширение тома выполнено успешно.

## Самостоятельная работа

С помощью fdisk создадим логический том lvgroup размером 200 МБ (рис. 36), (рис. 37)

![Создание логического тома lvgroup размером 200 МБ (1)](image/лаба15_36.png){#fig:036 width=40%} 

## Самостоятельная работа

![Создание логического тома lvgroup размером 200 МБ (2)](image/лаба15_37.png){#fig:037 width=70%} 

## Самостоятельная работа

Создаём группу томов с присвоенным ей физическим томом: *vgcreate vggroup /dev/sdb3* (рис.38)

![Создание группы томов с присвоенным ей физическим томом /dev/sdb3](image/лаба15_38.png){#fig:038 width=70%} 

## Самостоятельная работа

Введём *lvcreate -n lvgroup -l 50%FREE vggroup*. Это создаст логический том LVM с именем lvgroup, который будет использовать 50% доступного дискового пространства в группе томов vggroup (рис. 39)

![Создание логического тома LVM с именем lvgroup](image/лаба15_39.png){#fig:039 width=70%} 

## Самостоятельная работа

Теперь создаём файловую систему поверх логического тома. Для этого вводим *mkfs.xfs /dev/vggroup/lvgroup* (рис. 40)

![Создание файловой системы xfs поверх логического тома](image/лаба15_40.png){#fig:040 width=70%} 

## Самостоятельная работа

Создаём папку, на которую можно смонтировать том, вводим *mkdir -p /mnt/groups* (рис. 41)

![Создание папки /mnt/groups)](image/лаба15_41.png){#fig:041 width=70%}

## Самостоятельная работа

После добавляем следующую строку в /etc/fstab: */dev/vggroup/lvgroup /mnt/groups xfs defaults 1 2* (рис. 42), (рис. 43)

![Открытие файла /etc/fstab (3)](image/лаба15_42.png){#fig:042 width=70%}

## Самостоятельная работа

![Редактирование файла /etc/fstab (3)](image/лаба15_43.png){#fig:043 width=70%}

## Самостоятельная работа

Проверим, монтируется ли файловая система: *mount -a* и *mount | grep /mnt* (рис. 44)

![Проверка, что файловая система монтируется (2)](image/лаба15_44.png){#fig:044 width=70%}

## Самостоятельная работа

Перезагрузим ОС и проверим, что устройство подключается (рис. 45), (рис. 46)

![Перезапуск ОС](image/лаба15_45.png){#fig:045 width=70%}

## Самостоятельная работа

![Проверка после перезапуска](image/лаба15_46.png){#fig:046 width=70%}

## Самостоятельная работа

Увеличим lvgroup на 150M: *lvextend -r -L +150M /dev/vggroup/lvgroup* и проверим изменения (рис. 47)

![Увеличение lvgroup](image/лаба15_47.png){#fig:047 width=70%}

# Подведение итогов

## Выводы

В ходе выполнения лабораторной работы мы получили навыки управления логическими томами.

## Список литературы

1. Лаборатораня работа №15 [Электронный ресурс] URL: https://esystem.rudn.ru/pluginfile.php/2400759/mod_resource/content/4/016-lvm.pdf
